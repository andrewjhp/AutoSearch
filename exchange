from scrapy.spider import BaseSpider
from scrapy.selector import HtmlXPathSelector

from exchange.items import CarItem

class exchangeScraper(BaseSpider):
    name = "exchange"
    allowed_domains = ["www.exchangeandmart.co.uk"]
    start_urls = [
        "http://www.exchangeandmart.co.uk/used-cars-for-sale/bmw/m3/any-distance-from-ml85us?sort=newestfirst",
    ]

    def parse(self, response):
        response_html = HtmlXPathSelector(response)
  
        cars = []        
        result_content_list = response_html.select('//div[@id="contentSearchBox"]/div[@id="results"]')
        
        for index, result in enumerate(result_content_list):
            car = CarItem()                
            
            car_title = result.select('./div[2]/div/div[1]/a/text()')
            
            car["title"] = car_title.extract()

            
            cars.append(car)
        return cars
